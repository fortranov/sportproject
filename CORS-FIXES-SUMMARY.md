# üîß CORS –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ - –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **Backend CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** (`backend/main.py`)
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cors_origins = os.getenv("CORS_ORIGINS", "http://localhost:3000,http://127.0.0.1:3000").split(",")

app.add_middleware(
    CORSMiddleware,
    allow_origins=cors_origins,  # –¢–µ–ø–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ env
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE", "OPTIONS"],
    allow_headers=["*"],
)
```

### 2. **Docker Compose –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**

#### `docker-compose.yml` (–±–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `NEXT_PUBLIC_API_URL`: `http://backend:8000`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `CORS_ORIGINS` –¥–ª—è backend
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å Docker

#### `docker-compose.dev.yml` (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS origins –¥–ª—è dev –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω API URL –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–π —Å–µ—Ç–∏

### 3. **Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`nginx.conf`)
```nginx
# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã API routes
location ~ ^/(training-plan|users) {
    # CORS headers —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º origin
    add_header Access-Control-Allow-Origin $http_origin always;
    add_header Access-Control-Allow-Credentials true always;
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}
```

### 4. **–ü—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã)

#### `docker-compose.prod.yml`:
- üÜï –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- üÜï –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ)
- üÜï –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS origins –¥–ª—è –¥–æ–º–µ–Ω–∞

#### `nginx.prod.conf`:
- üÜï –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- üÜï Security headers
- üÜï Rate limiting
- üÜï –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- üÜï –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CORS

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã

### ‚ùå –ë—ã–ª–æ:
1. `NEXT_PUBLIC_API_URL=http://localhost:8000` - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Docker
2. CORS origins –∂–µ—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ –∫–æ–¥–µ
3. Nginx CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è `/api/` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å)
4. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
5. –°–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ)

### ‚úÖ –°—Ç–∞–ª–æ:
1. `NEXT_PUBLIC_API_URL=http://backend:8000` - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Docker —Å–µ—Ç–∏
2. CORS origins –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. Nginx CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π API
4. –ï—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
5. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ Nginx proxy

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
```bash
docker-compose -f docker-compose.dev.yml up --build
```

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω:
```bash
# 1. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–º–µ–Ω –≤ docker-compose.prod.yml
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
docker-compose -f docker-compose.prod.yml up --build -d
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CORS:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install axios

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤)
node test-cors-production.js
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
```
Internet ‚Üí Nginx (80/443) ‚Üí Frontend (internal) + Backend (internal)
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚úÖ Frontend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Nginx
- ‚úÖ Rate limiting –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç DDoS
- ‚úÖ Security headers –∑–∞—â–∏—â–∞—é—Ç –æ—Ç XSS/CSRF

## üìä –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

| –û–∫—Ä—É–∂–µ–Ω–∏–µ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | CORS Origins | API URL |
|-----------|-------------|-------------|---------|
| Local Dev | `npm run dev` | `localhost:3000` | `localhost:8000` |
| Docker Dev | `docker-compose.dev.yml` | `frontend:3000` | `backend:8000` |
| Docker Prod | `docker-compose.prod.yml` | `yourdomain.com` | —á–µ—Ä–µ–∑ Nginx |

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞

–í `docker-compose.prod.yml` –∑–∞–º–µ–Ω–∏—Ç–µ:
```yaml
environment:
  - CORS_ORIGINS=http://localhost,https://yourdomain.com,https://www.yourdomain.com
```

–í `nginx.prod.conf` –∑–∞–º–µ–Ω–∏—Ç–µ:
```nginx
server_name yourdomain.com www.yourdomain.com;
```

## üìù –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è

- [ ] –û–±–Ω–æ–≤–ª–µ–Ω –¥–æ–º–µ–Ω –≤ `docker-compose.prod.yml`
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω –¥–æ–º–µ–Ω –≤ `nginx.prod.conf`
- [ ] –ó–∞–ø—É—â–µ–Ω—ã –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–∏—Å—ã
- [ ] –¢–µ—Å—Ç—ã CORS –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
- [ ] Health checks —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] SSL –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚úÖ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞  
- ‚úÖ –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ SSL/HTTPS
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞—Ç–∞–∫

**–ü–ª–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!** üèä‚Äç‚ôÇÔ∏èüö¥‚Äç‚ôÇÔ∏èüèÉ‚Äç‚ôÇÔ∏è
